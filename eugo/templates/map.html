{% load static %}

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <!--Favicon-->
    <link rel="icon" href='{%static "/eugo/img/favicon.ico"%}'>

    <title>EUGO</title>
    
    <!--bootstrap CSS-->
    <link rel = "stylesheet" type = "text/css" href = '{% static "/eugo/css/bootstrap.css" %}'/>

    <!-- Custom styles for this template -->
    <link href='{% static "/eugo/css/leader.css" %}' rel="stylesheet"> 
    <link href='{% static "/eugo/css/map.css" %}' rel="stylesheet"> 

    <!--Ajax JS-->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>

    <!--Bootstrap JS-->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
  </head>

  <body>

    {% if not user.is_authenticated %}
    <script>window.location.href = "/eugo/logout/";</script>
    {% endif %}

    <div class="text-center parent-container-map" id="parent-container-map-id">
        
        <div class="map" id="mapConID">
            <img src='{% static "/eugo/img/exe_map_alpha.png" %}' class="map-img">
        </div>

        {% for i in lec %}
        <div class="lec-map-pin " style="position: absolute; z-index: 4; font-size: 10px;
        font-weight: bold; list-style-type: none;" id={{i.id}} value={{i.pos}}>
            <li style="color: black;">{{ i.name }}</li>
            <li style="color: black;">{{ i.duration }} Mins Remaining</li>
            <!--<li style="color: black;">{{ i.pos }}</li>-->
            <li><img src='{% static "/eugo/img/teacher_sprites/"%}{{i.sprite}}' class="spirite-img"></li>
            <li><button type="button" class="btn btn-light btn-sm" onclick="showCam('{{i.qrUrl}}','{{i.id}}')">Confirm QR Code</button></li>
        </div>
        {% endfor %}

        <button id="cam-button-cancel" class="btn btn-danger" onclick="hideCam()" style="position: absolute; text-align: center; top: 550px">Cancel</button> 
        <div style="width: 500px; position: absolute; text-align: center;" id="reader">
        </div>
        <div id="qr-reader-results"></div>
        </div>

        <input type="hidden" id="current-lec" value="">
        <input type="hidden" id="current-lec-id" value="">

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="/eugo/index">EUGO</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
      
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
              <a class="nav-link" href="/eugo/map">Map <span class="sr-only">(current)</span></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/eugo/lecturers">My Lecturers</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/eugo/lecturerdex">LecturerDex</a>
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    {{ user.get_username }}
                </a>
                <div class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                  <a class="dropdown-item" href="/eugo/player">Profile</a>
                  <a class="dropdown-item" href="/eugo/logout">Logout</a>
                </div>
              </li>
            <li class="nav-item">
                <a class="nav-link" href="/eugo/mapmod">MAPMOD!</a>
            </li>
        </div>
      </nav>

    <!--Leaderboard-->
    <div class="leaderboard slidein" id="leaderboard">
        <h1>
        <svg class="ico-cup">
            <use xlink:href="#cup"></use>
        </svg>
        Most Lecturers Caught
        </h1>
        <ol>
        <li>
            <mark>{{ players.0.username }}</mark>
            <small>{{ players.0.pokemon_caught }}</small>
        </li>
        <li>
            <mark>{{ players.1.username }}</mark>
            <small>{{ players.1.pokemon_caught }}</small>
        </li>
        <li>
            <mark>{{ players.2.username }}</mark>
            <small>{{ players.2.pokemon_caught }}</small>
        </li>
        <li>
            <mark>{{ players.3.username }}</mark>
            <small>{{ players.3.pokemon_caught }}</small>
        </li>
        <li>
            <mark>{{ players.4.username }}</mark>
            <small>{{ players.4.pokemon_caught }}</small>
        </li>
        <li>
            <mark>{{ players.5.username }}</mark>
            <small>{{ players.5.pokemon_caught }}</small>
        </li>
        <li>
            <mark>{{ players.6.username }}</mark>
            <small>{{ players.6.pokemon_caught }}</small>
        </li>
        <li>
            <mark>{{ players.7.username }}</mark>
            <small>{{ players.7.pokemon_caught }}</small>
        </li>  
        </ol>
    </div>

    <!--Chat Panel-->
    <div class="leaderboard slidein" id="leaderboard" style="
        top: 50%;
        right: 5.5%;
        left: 94.5%;
        padding: 3px;
        font-size: 15px;
    ">
        <div class="dropdown">
            <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Global Chat
            </button>
            <input type="hidden" value='global123' id='channel_selected'>
            <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <a class="dropdown-item" href="">My Friends</a>
            <a class="dropdown-item" href="">My Inbox</a>
            <a class="dropdown-item" href="">Contact Support</a>
            </div>
        </div>
        <!--messages-->
        <br>
        <section class="chat" id="chatbox"></section>
            {% for m in messages %}
            <p><strong>{{ m.user }}</strong> - {{ m.date }} : {{ m.content }}</p>
            {% endfor %}
          </section>
        
          <form>
            <input type="text" placeholder="Say something nice" name="message" id="usermsg" style="width: 65%;" />
            <button class="btn btn-light" name="submitmsg" type="submit" id="submitmsg" value="Send" onclick="sendChat('{{ user.get_username }}')" >Send</button>
          </form>

        <ol>
        </ol>
   
    </div>
    
    <!--chatbox script-->
    <script type="text/javascript">

        hidden = document.getElementById('channel_selected');

        function channelSelect(input){
            hidden.value = input;
        }

        function sendChat(username){
            $.ajax({
                type: "POST",
                url: "/eugo/sendchat/",
                data: {
                    'channel': hidden.value,
                    'user' : username,
                    'message' : document.getElementById('usermsg').value,
                },
                success: function (data) {
                    console.log("sent message");
                },
                error: function (data) {
                    console.log("error : ", JSON.stringify(data));
                },
            });
        }
    </script>

</body>
</html>

